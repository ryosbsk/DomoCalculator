<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>飛天オンライン計算機</title>
  </head>
  <style media="all">
    * {
      font-family: メイリオ;
    }
    label, select, input{
      display: block;
    }
  </style>
  <body>
    <h1>飛天オンラインダメージ計算機 ver.0.3</h1>
    <form>
      <label for="attack">自分の攻撃力</label><input type="text" id="attack">
      <label for="deffence">敵の防御力</label><input type="text" id="deffence">
      <label for="power">天賦の威力</label><input type="text" id="power">
      <label for="constant">定数</label>
      <select id="constant" disabled>
        <option value="6.25">6.25</option>
        <option value="7.5" selected>7.5</option>
      </select>
      <label for="increase">増加率(%)</label><input type="text" id="increase">
      <label for="element">属性値</label><input type="text" id="element">
      <label for="amplification">天賦の増幅率(%)</label><input type="text" id="amplification">
      <label for="jobIncrease">職業増加率(%)</label><input type="text" id="jobIncrease">
      <label for="enemyLevelGap">敵レベル差補正</label>
      <select id="enemyLevelGap">
          <option value="0.6">+60%</option>
          <option value="0.45">+45%</option>
          <option value="0.3">+30%</option>
          <option value="0.15">+15%</option>
          <option value="0" selected>0%</option>
          <option value="-0.15">-15%</option>
          <option value="-0.3">-30%</option>
          <option value="-0.45">-45%</option>
          <option value="-0.6">-60%</option>
      </select>
      <label for="skillLevelGap">習得レベル差補正</label>
      <select id="skillLevelGap">
        <option value="0">0%</option>
        <option value="-0.05">-5%</option>
        <option value="-0.1">-10%</option>
        <option value="-0.15">-15%</option>
        <option value="-0.2">-20%</option>
        <option value="-0.25">-25%</option>
        <option value="-0.3">-30%</option>
        <option value="-0.35">-35%</option>
        <option value="-0.4">-40%</option>
        <option value="-0.45">-45%</option>
        <option value="-0.5">-50%</option>
      </select>
      <label for="jobGap">職業差補正</label>
      <select id="jobGap">
        <option value="0">0%</option>
        <option value="-0.1">-10%</option>
        <option value="-0.2">-20%</option>
      </select>
      <input type="button" value="計算" onclick="calculate()">
    </form>
    与えるダメージ: <span id="damage">------</span>
    <hr>
    <h2>これは何？</h2>
    <p>
      MMORPG飛天オンラインのダメージ計算機です。
    </p>
    <h2>使い方</h2>
    <ol>
      <li>各フォームに数値を入力してください。</li>
      <li>計算ボタンをクリックしてください。</li>
    </ol>
    <h2>計算式について</h2>
    <p>
      以下は，<a href="http://domo-jp.e-whs.net/dmg.html">飛天オンライン・データベース</a>からの引用です。
    </p>
    <blockquote cite="http://domo-jp.e-whs.net/dmg.html">
      最終ダメージ＝(攻撃÷防御×補正(A)＋(物攻－物防)×補正(B))×補正(C)<br> 補正(A)＝威力÷定数×増加率(%)×属性(%)<br> 補正(B)＝増幅率(%)×増加率(%)×属性(%)<br> 補正(C)＝職業増加率(%)×敵レベル差補正(%)×習得レベル差補正(%)×職業差補正(%)×決闘補正(%)
    </blockquote>
    <p>
      各用語の説明は同サイトを参考してください。
      <br>計算結果は若干おおきめに出力されますが，おおむね正確です。
    </p>
    <h2>未実装</h2>
    <ul>
      <li>法術攻撃</li>
      <ul>
        <li>法術剣・使蟲など，物理攻撃力と法術攻撃力とを参照する天賦も正しい計算ができません。</li>
      </ul>
      <li>抵抗属性</li>
    </ul>
    <h2>製作者</h2>
    <p>
      <a href="https://twitter.com/ryosbsk">@ryosbsk</a>
    </p>
    <script type="text/javascript">
      function calculate(){
        // 変数の取得
        var attack = document.getElementById('attack').value - 0;
        var deffence = document.getElementById('deffence').value - 0;
        var power = document.getElementById('power').value - 0;
        var constant = document.getElementById('constant').value - 0;
        var increase = document.getElementById('increase').value - 0;
        var element = document.getElementById('element').value - 0;
        var amplification = document.getElementById('amplification').value - 0;
        var jobIncrease = document.getElementById('jobIncrease').value - 0;
        var enemyLevelGap = document.getElementById('enemyLevelGap').value - 0;
        var skillLevelGap = document.getElementById('skillLevelGap').value - 0;
        var jobGap = document.getElementById('jobGap').value - 0;

        console.log("attack: " + attack);
        console.log("deffence: " + deffence);
        console.log("power: " + power);
        console.log("constant: " + constant);
        console.log("increase: " + increase);
        console.log("element: " + element);
        console.log("amlification: " + amplification);
        console.log("jobIncrease: " + jobIncrease);
        console.log("enemyLevelGap: " + enemyLevelGap);
        console.log("skillLevelGap: " + skillLevelGap);
        console.log("jobGap: " + jobGap);

        // 補正
        increase = 1 + increase / 100;
        element = element + (1/2);
        if(element>100) element = 100;
        element = 1 + element / 100;
        amplification = amplification / 100;
        jobIncrease = 1 + jobIncrease / 100;
        enemyLevelGap = 1 + enemyLevelGap;
        skillLevelGap = 1 + skillLevelGap;
        jobGap = 1 + jobGap;

        console.log("--補正後--");
        console.log("increase: " + increase);
        console.log("element: " + element);
        console.log("amlification: " + amplification);
        console.log("jobIncrease: " + jobIncrease);
        console.log("enemyLevelGap: " + enemyLevelGap);
        console.log("skillLevelGap: " + skillLevelGap);
        console.log("jobGap: " + jobGap);

        // 計算
        /*
        最終ダメージ＝(攻撃÷防御×補正(A)＋(物攻－物防)×補正(B))×補正(C)
          補正(A)＝威力÷定数×増加率(%)×属性(%)
          補正(B)＝増幅率(%)×増加率(%)×属性(%)
          補正(C)＝職業増加率(%)×敵レベル差補正(%)×習得レベル差補正(%)×職業差補正(%)×決闘補正(%)
        */

        var basicDamage = attack / deffence;
        if (basicDamage > constant) basicDamage = constant;
        console.log("basicDamage: " + basicDamage);

        var correctionA = power / constant * increase * element;
        var correctionB = amplification * increase * element;
        var correctionC = jobIncrease * enemyLevelGap * skillLevelGap * jobGap;

        console.log("correctionA: " + correctionA);
        console.log("correctionB: " + correctionB);
        console.log("correctionC: "+ correctionC);

        var damage;
        damage = (basicDamage * correctionA + (attack - deffence) * correctionB) * correctionC;
        damage = Math.floor(damage);

        document.getElementById("damage").innerHTML = damage;

        console.log("---");
      }
    </script>
  </body>
</html>
